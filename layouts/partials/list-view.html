{{- /* ABOUTME: Simple vertical list partial for section pages */ -}}
{{- /* ABOUTME: Alternative to masonry-grid when list_style: list is set */ -}}

{{- $pages := .pages -}}
{{- $showSection := .showSection | default false -}}

{{- /* Issue #81: No manual filtering needed - Hugo's _build.list: false handles exclusion */ -}}

<ul class="list-view">
  {{- range $pages -}}

  {{- /* Issue #21: Resolve background image â€” same pattern as masonry-grid.html */ -}}
  {{- $bgImageUrl := "" -}}
  {{- $isGallery := .Params.gallery | default false -}}
  {{- if $isGallery -}}
    {{- if .Params.featured_image -}}
      {{- $featuredImg := .Resources.GetMatch .Params.featured_image -}}
      {{- if $featuredImg -}}
        {{- $bgImageUrl = $featuredImg.RelPermalink -}}
      {{- end -}}
    {{- else -}}
      {{- $images := .Resources.ByType "image" -}}
      {{- if $images -}}
        {{- $bgImageUrl = (index $images 0).RelPermalink -}}
      {{- end -}}
    {{- end -}}
  {{- else if .Params.image -}}
    {{- if .Params.image.src -}}
      {{- $bgImageUrl = printf "%s%s" .RelPermalink .Params.image.src -}}
    {{- end -}}
  {{- end -}}

  <li class="list-view-item{{ if $bgImageUrl }} has-image{{ end }}">
    {{- if $bgImageUrl -}}
    <div class="list-view-bg" style="background-image: url('{{ $bgImageUrl }}'); opacity: {{ $.Site.Params.bgImage.opacity | default 0.15 }}; filter: blur({{ $.Site.Params.bgImage.blur | default "5px" }});"></div>
    {{- end -}}
    <article class="list-view-content">
      <h3 class="list-view-title">
        <a href="{{ .RelPermalink }}" class="header-interactive">{{ .Title }}</a>
      </h3>
      <div class="list-view-meta">
        {{- if $showSection -}}
        <span class="list-view-section">{{ .Section | humanize }}</span>
        {{- end -}}
        {{- if .Date -}}
        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "2 Jan 2006" }}</time>
        {{- end -}}
      </div>
      {{- $excerpt := .Description | default .Summary -}}
      {{- if $excerpt -}}
      <p class="list-view-summary">{{ $excerpt | plainify | truncate 150 }}</p>
      {{- end -}}
    </article>
  </li>
  {{- end -}}
</ul>
